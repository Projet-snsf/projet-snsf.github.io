<!DOCTYPE html>
<html lang="fr">
<head>
    <title>Leaflet Routing Machine - Exemple complet</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <!-- Leaflet Routing Machine CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />

    <style>
        #map {
            width: 100%;
            height: 600px;
        }

        /* Personnalisation du panneau */
        .leaflet-routing-container {
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 14px;
            padding: 10px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <p id="info">Distance: - | Temps: -</p>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <!-- Leaflet Routing Machine JS -->
    <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>

    <!-- Leaflet Control Geocoder pour la recherche d'adresse -->
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

    <script>
        // Initialiser la carte
        var map = L.map('map').setView([48.8566, 2.3522], 13); // Coordonnées de Paris

        // Ajouter la couche de base OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 18
        }).addTo(map);

        // Définir une icône personnalisée pour les waypoints
        var customIcon = L.icon({
            iconUrl: 'https://upload.wikimedia.org/wikipedia/commons/e/ec/RedDot.svg', // URL de l'icône
            iconSize: [30, 30], // Taille de l'icône
            iconAnchor: [15, 15], // Point d'ancrage de l'icône
        });

        // Ajouter le contrôle de routage
        var control = L.Routing.control({
            waypoints: [
                L.latLng(48.8566, 2.3522),  // Point de départ : Paris
                L.latLng(48.864716, 2.349014)  // Point d'arrivée : Louvre
            ],
            language: 'fr', // Instructions en français
            routeWhileDragging: true,  // Recalculer l'itinéraire pendant que les waypoints sont déplacés
            addWaypoints: true,  // Permettre d'ajouter des waypoints
            draggableWaypoints: true,  // Activer le déplacement des waypoints
            fitSelectedRoutes: true,  // Ajuster la vue de la carte pour l'itinéraire calculé
            geocoder: L.Control.Geocoder.nominatim(),  // Ajouter un service de géocodage (Nominatim)
            createMarker: function(i, waypoint, n) {
                // Créer un marqueur personnalisé pour les waypoints
                return L.marker(waypoint.latLng, {
                    icon: customIcon,
                    draggable: true  // Activer le déplacement des marqueurs
                });
            },
            lineOptions: {
                styles: [{ color: 'blue', weight: 4 }] // Style de la ligne de l'itinéraire
            }
        }).addTo(map);

        // Récupérer la distance et le temps après le calcul de l'itinéraire
        control.on('routesfound', function(e) {
            var routes = e.routes;
            var summary = routes[0].summary;
            var distance = (summary.totalDistance / 1000).toFixed(2);  // Distance en kilomètres
            var time = summary.totalTime;  // Temps en secondes

            // Convertir le temps en heures et minutes
            var hours = Math.floor(time / 3600);
            var minutes = Math.floor((time % 3600) / 60);

            // Afficher la distance et le temps
            document.getElementById('info').innerText = 'Distance: ' + distance + ' km | Temps: ' + hours + 'h ' + minutes + 'm';
        });

        // Ajouter un contrôle pour la recherche d'adresse
        L.Control.geocoder({
            defaultMarkGeocode: false
        })
        .on('markgeocode', function(e) {
            var bbox = e.geocode.bbox;
            var poly = L.polygon([
                bbox.getSouthEast(),
                bbox.getNorthEast(),
                bbox.getNorthWest(),
                bbox.getSouthWest()
            ]).addTo(map);
            map.fitBounds(poly.getBounds());
        })
        .addTo(map);
    </script>
</body>
</html>
